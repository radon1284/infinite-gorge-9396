<% provide(:title, 'Dashboard') %>
<% content_for :body_class, 'theme-default main-menu-animated' %>
<script>var init = [];</script>
<% content_for :main_wrapper, 'main-wrapper' %>
<div class="content-wrapper">
  <% if current_user.role == 'admin' %>
  <p id="notice"><%= notice %></p>
  <h1>All Staffs </h1>
  <h3> Total Hrs: <%= @hr_min %></h3>
  <p><%= link_to 'New Staff', new_staff_path, class: 'btn btn-success', :role => 'button' %></p>
  <div id="no-more-tables">
  <table class="col-md-12 table-bordered table-striped table-condensed cf">
    <thead class="cf">
      <tr>
        <th rowspan="2">Full name</th>
        <th rowspan="2">Email</th>
        <th rowspan="2">Role</th>
        <th rowspan="2">Number of client</th>
        <th rowspan="2">Postion</th>
        <th colspan="4">Total work hour</th>
        <th colspan="3" rowspan="2"></th>
      </tr>
      <tr>
        <th>Today</th>
        <th>Week</th>
        <th>Month</th>
        <th>All Time</th>
      </tr>
    </thead>
    <tbody>
      <% @staffs.each do |staff| %>
        <tr>
          <td data-title="Name"><%= staff.full_name %></td>
          <td data-title="Email"><%= staff.user.email %></td>
          <td data-title="Role"><%= staff.user.role.humanize %></td>
          <td data-title="Role"><%= staff.clients.count %></td>
          <td data-title="Position"><%= staff.position %></td>
          <td data-title="Number of hrs today"></td>
          <td data-title="Number of hours this week"></td>
          <td data-title="Number of hours this month"></td>
          <td data-title="All time Number of hrs">
          </td>  
          <td data-title="Show"><%= link_to 'Show', staff %></td>
          <td data-title="Edit"><%= link_to 'Edit', edit_staff_path(staff) %></td>
          <td data-title="Delete"><%= link_to 'Delete', staff, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  </div>

  <h1>All Clients</h1>
  <p><%= link_to 'New Client', new_client_path, class: 'btn btn-success', :role => 'button' %></p>
  <div id="no-more-tables">
  <table class="col-md-12 table-bordered table-striped table-condensed cf">
    <thead class="cf">
      <tr>
        <th>Full name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Number of staff</th>
        <th>Business Name</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @clients.each do |client| %>
        <tr>
          <td data-title="Name"><%= client.full_name %></td>
          <td data-title="Email"><%= client.user.email %></td>

          <td data-title="Role"><%= client.user.role.humanize %> </td>
          <td data-title="Role"><%= client.staffs.count %></td>
          <td data-title="Business Name"><%= client.business_name %></td>
          <td data-title="Show"><%= link_to 'Show', client %></td>
          <td data-title="Edit"><%= link_to 'Edit', edit_client_path(client) %></td>
          <td data-title="Delete"><%= link_to 'Delete', client, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  </div>

  <% elsif current_user.role == 'manager' %>
  <% elsif current_user.role == 'team_leader' %>
  <% elsif current_user.role == 'client' %>
  	<h3>My Staff:</h3>
  	<div id="no-more-tables">
  	<table class="col-md-12 table-bordered table-striped table-condensed cf">
  	  <thead class="cf">
  	    <tr>
  	      <th rowspan="2">Full name</th>
  	      <th rowspan="2">Postion</th>
  	      <th colspan="3">Time</th>
  	    </tr>
  	    <tr>
  	      <th>Today</th>
  	      <th>Week</th>
  	      <th>Month</th>
  	    </tr>
  	  </thead>

  	  <tbody>
  	  <% @client.staffs.each do |staff| %>
  	    <tr>
  	        <td data-title="Name"><%= staff.full_name %></td>
  	        <td data-title="Position"><%= staff.position %></td>
  	        <td data-title="Today"></td>
  	        <td data-title="Week"></td>
  	        <td data-title="Month"></td>
  	      </tr>
  	  <% end %>
  	  </tbody>
  	</table>
  	</div>
  <% else %>
  	<h3>My Client:</h3>
  	<div id="no-more-tables">
  	<table class="col-md-12 table-bordered table-striped table-condensed cf">
  	  <thead class="cf">
  	    <tr>
  	      <th>Full name</th>
  	      <th>Business Name</th>
  	      <th>Time</th>
  	    </tr>
  	  </thead>

  	  <tbody>
  	  <% @total_hrs_by_date.each do |client|%>
  	    <tr>
  	        <td data-title="Name"><%= client.full_name %></td>
  	        <td data-title="Business Name"><%= client.business_name %></td>
  	        <td data-title="Month">
              <%= c = ("%.2f" % client.hrs_this_month).to_s.split(".").map { |s| s.to_i }
              a = c[0].to_s + ":" + ((c[1]*60)/100).to_s + " Hrs."

               %></td>
        </tr>
  	  <% end %>
  	  </tbody>
  	</table>
  	</div>
  <% end %>
  <div style="height:20px; clear:both;"></div>
  <div id="tasks_logs">
    <h2 id="month">
      <%= link_to "<", date: @date.prev_month %>
      <%= @date.strftime("%B %Y") %>
      <%= link_to ">", date: @date.next_month %>
    </h2>
    <%= calendar @date do |date| %>
      <%= date.day %>
      
        <% if @task_logs_by_date[date] %>
          <ul class="list-group">
            <% @task_logs_by_date[date].each do |task_log| %>
              <%= @hrs_by_day %>
              <% if task_log.user == current_user %>
                <li class="list-group-item">
                  <%= task_log.task_title %>
                </li>
              <% end %>
            <% end %>
          </ul>
        <% end %>
      <% end %>
  </div>
</div>